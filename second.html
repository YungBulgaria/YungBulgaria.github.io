<!DOCTYPE html>
<html>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <title>
        Second page
    </title>
    <h1> 
        Welcome to the second page!
    </h1>
    <body>
    
        <button onclick="window.location.href='index.html'"> Go back to main page </button>
    </body>

<body onload="init()">

    <svg width="800" height = "400"></svg>

    <script> 
        const urls = [
        "https://YungBulgaria.github.io/Data/medium_data1.csv",
        "https://YungBulgaria.github.io/Data/medium_data2.csv",
        "https://YungBulgaria.github.io/Data/medium_data3.csv",
        "https://YungBulgaria.github.io/Data/medium_data4.csv",
        "https://YungBulgaria.github.io/Data/medium_data5.csv",
        "https://YungBulgaria.github.io/Data/medium_data6.csv",
        "https://YungBulgaria.github.io/Data/medium_data7.csv"
        ]
        async function init() {
            let allData = []
            for (const url of urls) {
                const data = await d3.csv(url)
                allData = allData.concat(data)
            }

            const parseDate = d3.timeParse('%Y-%m-%d %H:%M:%S');
            allData.forEach(function(d) {
                d.Start_Time = parseDate(d.Start_Time); 
                d.Severity = +d.Severity; 
            });

            const monthlyData = d3.group(allData, d => d3.timeMonth(d.Start_Time));

            const averageData = Array.from(monthlyData, ([key, value]) => {
                return {
                    Start_Time: key,
                    averageSeverity: d3.mean(value, d => d.Severity)
                };
            });
            averageData.sort((a, b) => d3.ascending(a.Start_Time, b.Start_Time));

            // Define scales
                const margin = { top: 50, right: 30, bottom: 30, left: 50 };
                const width = 800 - margin.left - margin.right;
                const height = 400 - margin.top - margin.bottom;

                const xScale = d3.scaleTime()
                    .domain(d3.extent(averageData, d => d.Start_Time))
                    .range([0, width]);

                const yScale = d3.scaleLinear()
                    .domain([0, d3.max(averageData, d => d.averageSeverity)])
                    .nice()
                    .range([height, 0]);

                // Define line generator
                const line = d3.line()
                    .x(d => xScale(d.Start_Time))
                    .y(d => yScale(d.averageSeverity));

                // Append SVG element for line graph
                const svg = d3.select('svg')
                    .append('g')
                    .attr('transform', `translate(${margin.left}, ${margin.top})`);

                // Add the line path
                svg.append('path')
                    .datum(averageData)
                    .attr('fill', 'none')
                    .attr('stroke', 'steelblue')
                    .attr('stroke-width', 2)
                    .attr('d', line);

                // Add X axis
                svg.append('g')
                    .attr('transform', `translate(0, ${height})`)
                    .call(d3.axisBottom(xScale));

                // Add Y axis
                svg.append('g')
                    .call(d3.axisLeft(yScale));

                // Add title
                svg.append('text')
                    .attr('x', width / 2)
                    .attr('y', -10)
                    .attr('text-anchor', 'middle')
                    .style('font-size', '16px')
                    .text('Accident Severity Over Time');
        }
    </script>
</body>
    
</html>